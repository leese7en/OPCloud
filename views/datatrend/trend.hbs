<link rel="stylesheet" href="/plugins/bootstrap-datetimepicker/css/bootstrap-datetimepicker.min.css">
<script src="/plugins/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
<script src="/plugins/bootstrap-datetimepicker/js/locales/bootstrap-datetimepicker.zh-CN.js" type="text/javascript"></script>
<link href="/plugins/bootstrap-select2/css/select2.min.css" rel="stylesheet"/>
<script src="/plugins/bootstrap-select2/js/select2.min.js"></script>
<script src="/plugins/bootstrap-select2/js/i18n/zh-CN.js"></script>
<link href="/plugins/bootstrap-colorpicker/css/bootstrap-colorpicker.min.css" rel="stylesheet"/>
<script src="/plugins/bootstrap-colorpicker/js/bootstrap-colorpicker.min.js"></script>
<link href="/plugins/toastr/toastr.css" rel="stylesheet"/>
<script src="/plugins/toastr/toastr.min.js"></script>
<script type="text/javascript" src="/plugins/sweetalert/sweetalert.min.js"></script>
<link rel="stylesheet" type="text/css" href="/plugins/sweetalert/sweetalert.css">
<link href="/stylesheets/mobiscroll_date.css" rel="stylesheet"/>
<link href="/stylesheets/pointmodal.css" rel="stylesheet"/>
<script src="/plugins/mobile-date/mobiscroll_date.js"></script>
<script src="/plugins/mobile-date/mobiscroll.js"></script>
<script type="text/javascript" src="/plugins/trend-canvas/trendCanvas.js"></script>
<script type="text/javascript" src="/javascripts/datatrend/trend.js"></script>
<div class="modal fade" id="pointsTrendManage" tabindex="-1" role="dialog" aria-hidden="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header" style="padding:8px;">
                <h4 class="modal-title" style="font-size: 24px">
                    测点管理
                </h4>
            </div>
            <div class="modal-body" style="padding-top:1px;">
                <div class="box box-primary" style="height:26%">
                    <form class="form-horizontal" role="form">
                        <div class="row">
                            <label>开始时间</label>
                            <span id="trend_from_m"
                                  style="border:1px solid red;font-size:24px;display:inline-block;width: 30%">开始时间</span>
                            <label>结束时间</label>
                            <span id="trend_to_m"
                                  style="border:1px solid red;font-size:24px;display:inline-block;width: 30%">结束时间</span>
                            <button type="button" class="btn btn-success" style="font-size:24px;" onclick="queryData()">
                                查询
                            </button>
                        </div>
                    </form>
                    <div class="pointInfoTableDiv" style="overFlow-y: scroll; overflow-x: hidden;width: 100%;">
                        <table id="pointInfoTableManage" border="1px" cellspacing="0px" bordercolor="#C0C0C0">
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <div>
            <center><img src="/images/cancel.png" style="width:96px;height:96px;"
                         onclick="closePointsTrendManageModal()"/></center>
        </div>
    </div>
</div>
<div class="scrollable" id="scrollable">
    <div class="container" style="width: 80%;height: 100%;margin-left: 0px;">
        <div class="box box-primary" style="height:26%">
            <div class="row" style="padding-top: 2px; padding-left: 10px;height:100%;">
                <div class="notMobile">
                    <div class="col-xs-3 col-md-3" style="padding:0px 5px;">
                <span class="input-group" style="color: black; padding: 3px;" id="pointNameCon">
                    <span class="input-group-addon" style="color: black;">名称</span>
                        <select id="pointName" class="pointName form-control" style="width: 90%">
                            <option value="-1" selected="selected">请输入测点</option>
                        </select>
                </span>
                    </div>
                    <div class="col-xs-3 col-md-3" style="padding:0px 5px;">
                <span class="form-group">
                    <span class="input-group" style="color: black; padding: 3px;">
                        <span class="input-group-addon" style="color: black; padding: 3px;">开始时间</span>
                            <div id="trend_from" class="input-group date form_datetime">
                                <input class="form-control" type="text">
                                <span class="input-group-addon">
                                    <span class="glyphicon glyphicon-calendar"></span>
                                </span>
                            </div>
                        </span>
                    </span>
                        </span>
                    </div>
                    <div class="col-xs-3 col-md-3" style="padding:0px 5px;">
                    <span class="form-group">
                        <span class="input-group" style="color: black; padding: 3px;">
                            <span class="input-group-addon" style="color: black; padding: 3px;">结束时间</span>
                            <div id="trend_to" class="input-group date form_datetime">
                                <input class="form-control" type="text">
                                <span class="input-group-addon" style="height: 31px"/>
                                    <span class="glyphicon glyphicon-calendar"></span>
                            </div>
                        </span>
                    </span>
                    </div>
                    <div class="col-xs-3 col-md-3" style="padding:0px 5px;">
                        <div class="col-xs-6 col-md-6" style="padding:0px 5px;">
                    <span class="form-group">
                        <span class="input-group" style="color: black; padding: 3px;">
                            <span class="input-group-addon">时间</span>
                            <select id="trendTime" style="width: 100%" class="form-control">
                                <option value="-1">
                                    请选择
                                </option>
                                <option value="0" selected="selected">
                                    实时
                                </option>
                                <option value="1">
                                    1时
                                </option>
                                <option value="8">
                                    8时
                                </option>
                                <option value="24">
                                    1天
                                </option>
                                <option value="72">
                                    3天
                                </option>
                                <option value="168">
                                    7天
                                </option>
                                <option value="360">
                                    15天
                                </option>
                                <option value="720">
                                    30天
                                </option>
                            </select>
                        </span>
                    </span>
                        </div>
                        <div class="col-xs-6 col-md-6" style="padding:0px 5px;">
                            <ul class="nav navbar-left" style="color: black; padding: 3px;">
                                <button type="button" class="btn btn-success btn-sm" style="" onclick="queryData()" title="查询">
                                    <i class="glyphicon glyphicon-ok"></i>
                                </button>
                                <button type="button" class="btn btn-info btn-sm" style="" onclick="adaptiveRange()" title="自适应量程">
                                    <i class="glyphicon glyphicon-signal"></i>
                                </button>
                                <button type="button" class="btn btn-warn btn-sm" style="" onclick="indexMenuTrend()" title="设定为默认">
                                    <i class="glyphicon glyphicon-star"></i>
                                </button>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="isMobile" style="display:none;">
                    <ul class="nav navbar-left" style="color: black; font-size: 20px;width:100%;">
                        <span class="btnOperator">
                            <button type="button" class="btn btn-primary btn-mobile" style="margin-right:5px;"
                                    onclick="openPointsTrendManage()">
                                点管理
                            </button>
                            <button type="button" class="btn btn-warning btn-mobile" style="margin-right:5px;"
                                    onclick="pointManage()">
                                添加点
                            </button>
                            <div class="btn-group" role="group" aria-label="Second group">
                                <button type="button" class="btn btn-success btn-mobile" style="margin-right:5px;"
                                        onclick="shortCutSearch(0)">
                                    实时
                                </button>
                                 <button type="button" class="btn btn-success btn-mobile" style="margin-right:5px;"
                                         onclick="shortCutSearch(1)">
                                   1H
                                </button>
                                 <button type="button" class="btn btn-success btn-mobile" style="margin-right:5px;"
                                         onclick="shortCutSearch(8)">
                                   8H
                                </button>
                                 <button type="button" class="btn btn-success btn-mobile" style="margin-right:5px;"
                                         onclick="shortCutSearch(24)">
                                   1D
                                </button>
                                 <button type="button" class="btn btn-success btn-mobile" style="margin-right:5px;"
                                         onclick="shortCutSearch(168)">
                                    7D
                                </button>
                                <button type="button" class="btn btn-success btn-mobile" style="margin-right:5px;"
                                        onclick="shortCutSearch(720)">
                                    30D
                                </button>
                            </div>
                            <button type="button" class="btn btn-info btn-mobile" style="margin-right:10px;"
                                    onclick="adaptiveRange()">
                                自适应量程
                            </button>
                        </span>
                    </ul>
                </div>
                <div style="overflow-y:scroll; overflow-x: hidden;height: 80%;width: 100%;">
                    <table id="pointInfoTable" border="1px" cellspacing="0px" bordercolor="#C0C0C0">
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
        <div style="margin-top:10px;">
            <canvas id="trend_container"></canvas>
        </div>
    </div>
</div>
<div class="theme-popover" id="testID">
    <select id="pointName" class="pointName form-control" style="width:100%;">
        <option value="-1" selected="selected">请输入测点</option>
    </select>
    |
</div>
<div class="theme-popover-mask" onclick="pointCloseManage()"></div>
<style>
    .btn-mobile {
        height: 50px;
        padding: 3px 10px;
        font-size: 28px;
    }

    .mobilePointtable .form-control {
        height: 40px;
        font-size: 28px;
        padding: 1px 3px;
    }

    .mobilePointtable .input-group-addon {
        font-size: 24px;
        padding: 3px 3px;
    }

    #pointsTrendManage {
        font-size: 24px;
    }

    #pointsTrendManage .form-control {
        height: 40px;
        font-size: 24px;
        padding: 1px 3px;
    }

    #pointsTrendManage .input-group-addon {
        font-size: 24px;
        padding: 3px 3px;
    }

    .select2-dropdown {
        z-index: 10000;
    }

    .theme-popover .select2-container {
        font-size: 24px;
    }

    .theme-popover .select2-container .select2-dropdown {
        font-size: 24px;
    }

    .theme-popover .select2-container .select2-search__field {
        font-size: 24px;
    }

</style>
<script>
    var trendGroup;
    $(document).ready(function () {
        toastr.options.positionClass = 'toast-top-center';
        if (window.parent.socket) {
            socket = window.parent.socket;
        } else {
            var token = '{{token}}';
            socket = io.connect(socketURI, {
                'query': 'token=' + token
            });
        }
        socket.on('reconnect', function () {
            if (graph) {
                trendGroup.resetSocket(socket);
            }
        });
        var args = getUrlParms();
        var pns = "", from = "", to = "";
        pns = '{{pointNames}}';
        from = args['from'];
        to = args['end'];
        if (from == undefined || from == "") {
            $('#trend_from').find('input').val();
        }
        if (to == undefined || to == "") {
            $('#trend_to').find('input').val();
        }
        if (pns != undefined && pns.length > 1
                && pns.substring(pns.length - 1, pns.length) == ",") {
            pns = pns.substring(0, pns.length - 1);
        }
        var bd, ed;
        if (from) {
            var begin = from.replace(/-/g, "/");
            bd = new Date(begin);
        }
        if (to) {
            var end = to.replace(/-/g, "/");
            ed = new Date(end);
            if (bd > ed) {
                alert("开始时间必须小于结束时间！");
                return;
            }
        }
        if (!pns || pns.length == 0) {
            pns = '/lhd/AX,/lhd/R8';
        }
        trendGroup = new defaultTrendGroup()
        var op = new opTrend();
        trendGroup.trendcontainer = 'trend_container';
        trendGroup.opTrend = op;
        trendGroup.pointsTable = "pointInfoTable";
        trendGroup.socket = socket;

        var DPR = window.devicePixelRatio ? window.devicePixelRatio : 1;
        //设置窗口监听事件
        $(window).resize(function () {
            //浏览器窗口变化
            if (trendGroup) {
                if (trendGroup.isMobile) {
                    window_w = $(window).width() * DPR;
                    window_h = $(window).height() * DPR - 10;
                    trendGroup.documentWidth = window_w - 20;
                    trendGroup.documentHeight = window_h - 80;
                    if (trendGroup.documentWidth < trendGroup.documentHeight) {
                        trendGroup.opTrend.widthRatioA = 12;
                        trendGroup.isHorizontalScreen = false;
                    } else {
                        trendGroup.opTrend.widthRatioA = 13;
                        trendGroup.isHorizontalScreen = true;
                    }
                    if (trendGroup.defaultTrendString && trendGroup.defaultTrendString.length > 0) {
                        trendGroup.setHtmlCss();
                    }
                    trend_Util.setCanvasClick(trendGroup);
                    trend_Util.setCanvasFun(trendGroup);
                } else {
                    trendGroup.documentWidth = $(window).width();
                    trendGroup.documentHeight = $(window).height() - 65;
                    if (trendGroup.defaultTrendString && trendGroup.defaultTrendString.length > 0) {
                        trendGroup.setHtmlCss();
                    }
                }
            }
        });
        var window_w = 0;
        var window_h = 0;
        if (!isMobile.any()) {
            window_w = $(window).width();
            window_h = $(window).height() - 65;
            document.documentElement.style.overflow = 'hidden';
            trendGroup.documentWidth = window_w;
            trendGroup.documentHeight = window_h;
        } else {
            window_w = $(window).width() * DPR;
            window_h = $(window).height() * DPR;
            if (isMobile.iPhone() && window_w > 1500) {
                trendGroup.iosPlus = true;
            }
            trendGroup.isMobile = true;
            trendGroup.trendInfoHeight = 30;
            trendGroup.documentWidth = window_w;
            trendGroup.documentHeight = window_h;
            if (trendGroup.documentWidth < trendGroup.documentHeight) {
                trendGroup.opTrend.widthRatioA = 12;
                trendGroup.isHorizontalScreen = false;
            } else {
                trendGroup.opTrend.widthRatioA = 13;
                trendGroup.isHorizontalScreen = true;
            }
            document.addEventListener("visibilitychange", function () {
                if (trendGroup && trendGroup.defaultTrendString && trendGroup.defaultTrendString.length > 0) {
                    trendGroup.pageVisibility();
                }
            }, false);
        }
        initDate();
        initPointName();
        trendGroup.addName(pns, from, to);
        document.addEventListener('DOMContentLoaded', ready, false);
        // document.addEventListener('touchmove', function (ev){
        //     ev.preventDefault();
        // }, false);
        function ready() {
            document.querySelector('.body').addEventListener('touchmove', function (ev) {
                ev.stopPropagation();
            }, false);
        }
    });
</script>
